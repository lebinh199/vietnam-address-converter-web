<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VN Ward Converter (Old ↔ New) • SQL from GitHub / Local</title>
  <meta name="description" content="Chuyển đổi đơn vị hành chính cấp xã/phường trước ↔ sau sáp nhập. Nạp ward_mappings.sql từ GitHub hoặc file máy. Chạy client-side bằng sql.js (SQLite WASM)." />
  <style>
    :root{--bg:#0b1020;--card:#12182a;--muted:#9aa4b2;--text:#e8eef8;--accent:#4f8cff}
    html,body{background:var(--bg);color:var(--text)}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;max-width:1100px;margin:36px auto;padding:0 16px}
    h1{font-size:24px;margin:0 0 10px}
    .muted{color:var(--muted);font-size:13px}
    .card{background:var(--card);border:1px solid #20283f;border-radius:16px;padding:16px;margin:14px 0}
    input[type=text],textarea,select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #263155;background:#0f1526;color:#e8eef8}
    textarea{min-height:180px}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .btn{background:linear-gradient(135deg,#477cff,#6aa7ff);color:#fff;border:none;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
    .btn.secondary{background:#25314d}
    pre{white-space:pre-wrap;word-break:break-word;background:#0f1526;border:1px dashed #2b375a;padding:12px;border-radius:10px;min-height:120px}
    .ok{color:#52ffa8}
    .err{color:#ff6b6b}
    .tag{display:inline-block;background:#1a2240;border:1px solid #2b375a;border-radius:999px;padding:2px 8px;margin-right:6px;color:#c7d3e7;font-size:12px}
    footer{margin-top:20px;font-size:12px;color:#8ea2c7}
    a{color:#9bbcff}
  </style>
</head>
<body>
  <h1>VN Ward Converter (Old ↔ New)</h1>
  <p class="muted">Dùng file <code>ward_mappings.sql</code> (schema MySQL như bạn cung cấp). Có thể nạp từ <strong>GitHub Raw URL</strong> hoặc <strong>chọn file .sql</strong> từ máy. App chạy hoàn toàn trên trình duyệt bằng <strong>sql.js</strong> (SQLite&nbsp;WASM).</p>

  <div class="card row">
    <div class="row">
      <label>GitHub SQL URL (raw hoặc blob):</label>
      <input id="sqlUrl" type="text" placeholder="https://raw.githubusercontent.com/<org>/<repo>/<path>/ward_mappings.sql" />
    </div>
    <div class="grid2">
      <button class="btn" id="loadSqlBtn">1) Nạp SQL từ URL</button>
      <button class="btn secondary" id="pasteDemoBtn" type="button">Dán dữ liệu mẫu</button>
    </div>
    <div class="row">
      <label>Hoặc chọn file <code>ward_mappings.sql</code> từ máy (MySQL dump):</label>
      <input id="sqlFile" type="file" accept=".sql" />
      <button class="btn" id="loadSqlFileBtn" type="button">Nạp SQL từ file</button>
    </div>
    <div id="sqlStatus" class="muted">Chưa nạp SQL.</div>
  </div>

  <div class="card row">
    <div class="grid2">
      <div>
        <label>Chế độ chuyển đổi</label>
        <select id="mode">
          <option value="old2new">Cũ → Mới (old → new)</option>
          <option value="new2old">Mới → Cũ (new → old)</option>
        </select>
      </div>
      <label style="align-self:end"><input type="checkbox" id="noHeader" /> Xuất KHÔNG có header</label>
    </div>
    <label>Dữ liệu đầu vào (TSV/CSV – có thể có header):</label>
    <textarea id="input" placeholder="Ví dụ TSV:\nold_ward_code\told_ward_name\told_district_name\told_province_name\n26881\tPhường 12\tQuận Gò Vấp\tThành phố Hồ Chí Minh"></textarea>
    <div class="grid2">
      <button class="btn" id="convertBtn">2) Chuyển đổi</button>
      <button class="btn secondary" id="copyBtn">Copy kết quả</button>
    </div>
  </div>

  <div class="card row">
    <div>
      <span class="tag">Kết quả TSV</span>
      <span id="rowCount" class="muted"></span>
    </div>
    <pre id="output"></pre>
  </div>

  <!-- sql.js (SQLite WASM) -->
  <script src="https://cdn.jsdelivr.net/npm/sql.js@1.10.2/dist/sql-wasm.js"></script>
  <!-- App logic -->
  <script type="module" src="./app.js"></script>

  <footer>
    <p>Tip: Đặt <code>ward_mappings.sql</code> ở thư mục gốc repo → trang sẽ tự nạp khi mở lần đầu. Nếu lỗi 404, hãy nhập URL raw hoặc chọn file .sql.</p>
  </footer>
</body>
</html>
